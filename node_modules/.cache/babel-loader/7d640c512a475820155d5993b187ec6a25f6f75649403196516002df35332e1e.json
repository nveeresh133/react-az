{"ast":null,"code":"/*\n * Application Insights JavaScript SDK - Web Analytics, 3.3.1\n * Copyright (c) Microsoft and contributors. All rights reserved.\n */\n\nimport dynamicProto from \"@microsoft/dynamicproto-js\";\nimport { utlCanUseSessionStorage, utlGetSessionStorage, utlRemoveSessionStorage, utlSetSessionStorage } from \"@microsoft/applicationinsights-common\";\nimport { _warnToConsole, dateNow, dumpObj, getJSON, hasJSON, throwError } from \"@microsoft/applicationinsights-core-js\";\nimport { objDefine } from \"@nevware21/ts-utils\";\nimport { _DYN_PAGE_VISIT_START_TIM18, _DYN_TRACK_PREVIOUS_PAGE_1 } from \"../../__DynamicConstants\";\n/**\r\n * Used to track page visit durations\r\n */\nvar PageVisitTimeManager = /** @class */function () {\n  /**\r\n   * Creates a new instance of PageVisitTimeManager\r\n   * @param pageVisitTimeTrackingHandler - Delegate that will be called to send telemetry data to AI (when trackPreviousPageVisit is called)\r\n   * @returns {}\r\n   */\n  function PageVisitTimeManager(logger, pageVisitTimeTrackingHandler) {\n    var prevPageVisitDataKeyName = \"prevPageVisitData\";\n    dynamicProto(PageVisitTimeManager, this, function (_self) {\n      _self[_DYN_TRACK_PREVIOUS_PAGE_1 /* @min:%2etrackPreviousPageVisit */] = function (currentPageName, currentPageUrl) {\n        try {\n          // Restart timer for new page view\n          var prevPageVisitTimeData = restartPageVisitTimer(currentPageName, currentPageUrl);\n          // If there was a page already being timed, track the visit time for it now.\n          if (prevPageVisitTimeData) {\n            pageVisitTimeTrackingHandler(prevPageVisitTimeData.pageName, prevPageVisitTimeData.pageUrl, prevPageVisitTimeData.pageVisitTime);\n          }\n        } catch (e) {\n          _warnToConsole(logger, \"Auto track page visit time failed, metric will not be collected: \" + dumpObj(e));\n        }\n      };\n      /**\r\n       * Stops timing of current page (if exists) and starts timing for duration of visit to pageName\r\n       * @param pageName - Name of page to begin timing visit duration\r\n       * @returns {PageVisitData} Page visit data (including duration) of pageName from last call to start or restart, if exists. Null if not.\r\n       */\n      function restartPageVisitTimer(pageName, pageUrl) {\n        var prevPageVisitData = null;\n        try {\n          prevPageVisitData = stopPageVisitTimer();\n          if (utlCanUseSessionStorage()) {\n            if (utlGetSessionStorage(logger, prevPageVisitDataKeyName) != null) {\n              throwError(\"Cannot call startPageVisit consecutively without first calling stopPageVisit\");\n            }\n            var currPageVisitDataStr = getJSON().stringify(new PageVisitData(pageName, pageUrl));\n            utlSetSessionStorage(logger, prevPageVisitDataKeyName, currPageVisitDataStr);\n          }\n        } catch (e) {\n          _warnToConsole(logger, \"Call to restart failed: \" + dumpObj(e));\n          prevPageVisitData = null;\n        }\n        return prevPageVisitData;\n      }\n      /**\r\n       * Stops timing of current page, if exists.\r\n       * @returns {PageVisitData} Page visit data (including duration) of pageName from call to start, if exists. Null if not.\r\n       */\n      function stopPageVisitTimer() {\n        var prevPageVisitData = null;\n        try {\n          if (utlCanUseSessionStorage()) {\n            // Define end time of page's visit\n            var pageVisitEndTime = dateNow();\n            // Try to retrieve  page name and start time from session storage\n            var pageVisitDataJsonStr = utlGetSessionStorage(logger, prevPageVisitDataKeyName);\n            if (pageVisitDataJsonStr && hasJSON()) {\n              // if previous page data exists, set end time of visit\n              prevPageVisitData = getJSON().parse(pageVisitDataJsonStr);\n              prevPageVisitData.pageVisitTime = pageVisitEndTime - prevPageVisitData[_DYN_PAGE_VISIT_START_TIM18 /* @min:%2epageVisitStartTime */];\n              // Remove data from storage since we already used it\n              utlRemoveSessionStorage(logger, prevPageVisitDataKeyName);\n            }\n          }\n        } catch (e) {\n          _warnToConsole(logger, \"Stop page visit timer failed: \" + dumpObj(e));\n          prevPageVisitData = null;\n        }\n        return prevPageVisitData;\n      }\n      // For backward compatibility\n      objDefine(_self, \"_logger\", {\n        g: function () {\n          return logger;\n        }\n      });\n      objDefine(_self, \"pageVisitTimeTrackingHandler\", {\n        g: function () {\n          return pageVisitTimeTrackingHandler;\n        }\n      });\n    });\n  }\n  // Removed Stub for PageVisitTimeManager.prototype.trackPreviousPageVisit.\n  // This is a workaround for an IE bug when using dynamicProto() with classes that don't have any\n  // non-dynamic functions or static properties/functions when using uglify-js to minify the resulting code.\n  PageVisitTimeManager.__ieDyn = 1;\n  return PageVisitTimeManager;\n}();\nexport { PageVisitTimeManager };\nvar PageVisitData = /** @class */function () {\n  function PageVisitData(pageName, pageUrl) {\n    this[_DYN_PAGE_VISIT_START_TIM18 /* @min:%2epageVisitStartTime */] = dateNow();\n    this.pageName = pageName;\n    this.pageUrl = pageUrl;\n  }\n  return PageVisitData;\n}();\nexport { PageVisitData };","map":{"version":3,"names":["dynamicProto","utlCanUseSessionStorage","utlGetSessionStorage","utlRemoveSessionStorage","utlSetSessionStorage","_warnToConsole","dateNow","dumpObj","getJSON","hasJSON","throwError","objDefine","_DYN_PAGE_VISIT_START_TIM18","_DYN_TRACK_PREVIOUS_PAGE_1","PageVisitTimeManager","logger","pageVisitTimeTrackingHandler","prevPageVisitDataKeyName","_self","currentPageName","currentPageUrl","prevPageVisitTimeData","restartPageVisitTimer","pageName","pageUrl","pageVisitTime","e","prevPageVisitData","stopPageVisitTimer","currPageVisitDataStr","stringify","PageVisitData","pageVisitEndTime","pageVisitDataJsonStr","parse","g"],"sources":["/home/veeresh133/app/react-az/node_modules/@microsoft/applicationinsights-analytics-js/dist-es5/JavaScriptSDK/Telemetry/PageVisitTimeManager.js"],"sourcesContent":["// Copyright (c) Microsoft Corporation. All rights reserved.\r\n// Licensed under the MIT License.\r\nimport dynamicProto from \"@microsoft/dynamicproto-js\";\r\nimport { utlCanUseSessionStorage, utlGetSessionStorage, utlRemoveSessionStorage, utlSetSessionStorage } from \"@microsoft/applicationinsights-common\";\r\nimport { _warnToConsole, dateNow, dumpObj, getJSON, hasJSON, throwError } from \"@microsoft/applicationinsights-core-js\";\r\nimport { objDefine } from \"@nevware21/ts-utils\";\r\nimport { _DYN_PAGE_VISIT_START_TIM18, _DYN_TRACK_PREVIOUS_PAGE_1 } from \"../../__DynamicConstants\";\r\n/**\r\n * Used to track page visit durations\r\n */\r\nvar PageVisitTimeManager = /** @class */ (function () {\r\n    /**\r\n     * Creates a new instance of PageVisitTimeManager\r\n     * @param pageVisitTimeTrackingHandler - Delegate that will be called to send telemetry data to AI (when trackPreviousPageVisit is called)\r\n     * @returns {}\r\n     */\r\n    function PageVisitTimeManager(logger, pageVisitTimeTrackingHandler) {\r\n        var prevPageVisitDataKeyName = \"prevPageVisitData\";\r\n        dynamicProto(PageVisitTimeManager, this, function (_self) {\r\n            _self[_DYN_TRACK_PREVIOUS_PAGE_1 /* @min:%2etrackPreviousPageVisit */] = function (currentPageName, currentPageUrl) {\r\n                try {\r\n                    // Restart timer for new page view\r\n                    var prevPageVisitTimeData = restartPageVisitTimer(currentPageName, currentPageUrl);\r\n                    // If there was a page already being timed, track the visit time for it now.\r\n                    if (prevPageVisitTimeData) {\r\n                        pageVisitTimeTrackingHandler(prevPageVisitTimeData.pageName, prevPageVisitTimeData.pageUrl, prevPageVisitTimeData.pageVisitTime);\r\n                    }\r\n                }\r\n                catch (e) {\r\n                    _warnToConsole(logger, \"Auto track page visit time failed, metric will not be collected: \" + dumpObj(e));\r\n                }\r\n            };\r\n            /**\r\n             * Stops timing of current page (if exists) and starts timing for duration of visit to pageName\r\n             * @param pageName - Name of page to begin timing visit duration\r\n             * @returns {PageVisitData} Page visit data (including duration) of pageName from last call to start or restart, if exists. Null if not.\r\n             */\r\n            function restartPageVisitTimer(pageName, pageUrl) {\r\n                var prevPageVisitData = null;\r\n                try {\r\n                    prevPageVisitData = stopPageVisitTimer();\r\n                    if (utlCanUseSessionStorage()) {\r\n                        if (utlGetSessionStorage(logger, prevPageVisitDataKeyName) != null) {\r\n                            throwError(\"Cannot call startPageVisit consecutively without first calling stopPageVisit\");\r\n                        }\r\n                        var currPageVisitDataStr = getJSON().stringify(new PageVisitData(pageName, pageUrl));\r\n                        utlSetSessionStorage(logger, prevPageVisitDataKeyName, currPageVisitDataStr);\r\n                    }\r\n                }\r\n                catch (e) {\r\n                    _warnToConsole(logger, \"Call to restart failed: \" + dumpObj(e));\r\n                    prevPageVisitData = null;\r\n                }\r\n                return prevPageVisitData;\r\n            }\r\n            /**\r\n             * Stops timing of current page, if exists.\r\n             * @returns {PageVisitData} Page visit data (including duration) of pageName from call to start, if exists. Null if not.\r\n             */\r\n            function stopPageVisitTimer() {\r\n                var prevPageVisitData = null;\r\n                try {\r\n                    if (utlCanUseSessionStorage()) {\r\n                        // Define end time of page's visit\r\n                        var pageVisitEndTime = dateNow();\r\n                        // Try to retrieve  page name and start time from session storage\r\n                        var pageVisitDataJsonStr = utlGetSessionStorage(logger, prevPageVisitDataKeyName);\r\n                        if (pageVisitDataJsonStr && hasJSON()) {\r\n                            // if previous page data exists, set end time of visit\r\n                            prevPageVisitData = getJSON().parse(pageVisitDataJsonStr);\r\n                            prevPageVisitData.pageVisitTime = pageVisitEndTime - prevPageVisitData[_DYN_PAGE_VISIT_START_TIM18 /* @min:%2epageVisitStartTime */];\r\n                            // Remove data from storage since we already used it\r\n                            utlRemoveSessionStorage(logger, prevPageVisitDataKeyName);\r\n                        }\r\n                    }\r\n                }\r\n                catch (e) {\r\n                    _warnToConsole(logger, \"Stop page visit timer failed: \" + dumpObj(e));\r\n                    prevPageVisitData = null;\r\n                }\r\n                return prevPageVisitData;\r\n            }\r\n            // For backward compatibility\r\n            objDefine(_self, \"_logger\", { g: function () { return logger; } });\r\n            objDefine(_self, \"pageVisitTimeTrackingHandler\", { g: function () { return pageVisitTimeTrackingHandler; } });\r\n        });\r\n    }\r\n    /**\r\n    * Tracks the previous page visit time telemetry (if exists) and starts timing of new page visit time\r\n    * @param currentPageName - Name of page to begin timing for visit duration\r\n    * @param currentPageUrl - Url of page to begin timing for visit duration\r\n    */\r\n    PageVisitTimeManager.prototype.trackPreviousPageVisit = function (currentPageName, currentPageUrl) {\r\n        // @DynamicProtoStub -- DO NOT add any code as this will be removed during packaging\r\n    };\r\n    return PageVisitTimeManager;\r\n}());\r\nexport { PageVisitTimeManager };\r\nvar PageVisitData = /** @class */ (function () {\r\n    function PageVisitData(pageName, pageUrl) {\r\n        this[_DYN_PAGE_VISIT_START_TIM18 /* @min:%2epageVisitStartTime */] = dateNow();\r\n        this.pageName = pageName;\r\n        this.pageUrl = pageUrl;\r\n    }\r\n    return PageVisitData;\r\n}());\r\nexport { PageVisitData };\r\n//# sourceMappingURL=PageVisitTimeManager.js.map"],"mappings":";;;;;AAEA,OAAAA,YAAA;AACA,SAAAC,uBAAA,EAAAC,oBAAA,EAAAC,uBAAA,EAAAC,oBAAA;AACA,SAAAC,cAAA,EAAAC,OAAA,EAAAC,OAAA,EAAAC,OAAA,EAAAC,OAAA,EAAAC,UAAA;AACA,SAAAC,SAAA;AACA,SAAAC,2BAAA,EAAAC,0BAAA;AACA;AACA;AACA;AACA,IAAAC,oBAAA;EACA;AACA;AACA;AACA;AACA;EACA,SAAAA,qBAAAC,MAAA,EAAAC,4BAAA;IACA,IAAAC,wBAAA;IACAjB,YAAA,CAAAc,oBAAA,kBAAAI,KAAA;MACAA,KAAA,CAAAL,0BAAA,mDAAAM,eAAA,EAAAC,cAAA;QACA;UACA;UACA,IAAAC,qBAAA,GAAAC,qBAAA,CAAAH,eAAA,EAAAC,cAAA;UACA;UACA,IAAAC,qBAAA;YACAL,4BAAA,CAAAK,qBAAA,CAAAE,QAAA,EAAAF,qBAAA,CAAAG,OAAA,EAAAH,qBAAA,CAAAI,aAAA;UACA;QACA,EACA,OAAAC,CAAA;UACArB,cAAA,CAAAU,MAAA,wEAAAR,OAAA,CAAAmB,CAAA;QACA;MACA;MACA;AACA;AACA;AACA;AACA;MACA,SAAAJ,sBAAAC,QAAA,EAAAC,OAAA;QACA,IAAAG,iBAAA;QACA;UACAA,iBAAA,GAAAC,kBAAA;UACA,IAAA3B,uBAAA;YACA,IAAAC,oBAAA,CAAAa,MAAA,EAAAE,wBAAA;cACAP,UAAA;YACA;YACA,IAAAmB,oBAAA,GAAArB,OAAA,GAAAsB,SAAA,KAAAC,aAAA,CAAAR,QAAA,EAAAC,OAAA;YACApB,oBAAA,CAAAW,MAAA,EAAAE,wBAAA,EAAAY,oBAAA;UACA;QACA,EACA,OAAAH,CAAA;UACArB,cAAA,CAAAU,MAAA,+BAAAR,OAAA,CAAAmB,CAAA;UACAC,iBAAA;QACA;QACA,OAAAA,iBAAA;MACA;MACA;AACA;AACA;AACA;MACA,SAAAC,mBAAA;QACA,IAAAD,iBAAA;QACA;UACA,IAAA1B,uBAAA;YACA;YACA,IAAA+B,gBAAA,GAAA1B,OAAA;YACA;YACA,IAAA2B,oBAAA,GAAA/B,oBAAA,CAAAa,MAAA,EAAAE,wBAAA;YACA,IAAAgB,oBAAA,IAAAxB,OAAA;cACA;cACAkB,iBAAA,GAAAnB,OAAA,GAAA0B,KAAA,CAAAD,oBAAA;cACAN,iBAAA,CAAAF,aAAA,GAAAO,gBAAA,GAAAL,iBAAA,CAAAf,2BAAA;cACA;cACAT,uBAAA,CAAAY,MAAA,EAAAE,wBAAA;YACA;UACA;QACA,EACA,OAAAS,CAAA;UACArB,cAAA,CAAAU,MAAA,qCAAAR,OAAA,CAAAmB,CAAA;UACAC,iBAAA;QACA;QACA,OAAAA,iBAAA;MACA;MACA;MACAhB,SAAA,CAAAO,KAAA;QAAAiB,CAAA,WAAAA,CAAA;UAAA,OAAApB,MAAA;QAAA;MAAA;MACAJ,SAAA,CAAAO,KAAA;QAAAiB,CAAA,WAAAA,CAAA;UAAA,OAAAnB,4BAAA;QAAA;MAAA;IACA;EACA;EACA;;;;;AASA;AACA,SAAAF,oBAAA;AACA,IAAAiB,aAAA;EACA,SAAAA,cAAAR,QAAA,EAAAC,OAAA;IACA,KAAAZ,2BAAA,qCAAAN,OAAA;IACA,KAAAiB,QAAA,GAAAA,QAAA;IACA,KAAAC,OAAA,GAAAA,OAAA;EACA;EACA,OAAAO,aAAA;AACA;AACA,SAAAA,aAAA","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}