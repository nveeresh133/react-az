{"version":3,"file":"ReactPlugin.js.map","sources":["ReactPlugin.js"],"sourcesContent":["/**\r\n* ReactPlugin.ts\r\n* @copyright Microsoft 2019\r\n*/\r\nimport { __extends } from \"tslib\";\r\nimport dynamicProto from \"@microsoft/dynamicproto-js\";\r\nimport { AnalyticsPluginIdentifier } from \"@microsoft/applicationinsights-common\";\r\nimport { BaseTelemetryPlugin, _throwInternal, isFunction, proxyFunctions, safeGetCookieMgr, onConfigChange, objDefineAccessors } from \"@microsoft/applicationinsights-core-js\";\r\nimport { objDeepFreeze } from \"@nevware21/ts-utils\";\r\nvar defaultReactExtensionConfig = objDeepFreeze({\r\n    history: { blkVal: true, v: undefined }\r\n});\r\nvar ReactPlugin = /** @class */ (function (_super) {\r\n    __extends(ReactPlugin, _super);\r\n    function ReactPlugin() {\r\n        var _this = _super.call(this) || this;\r\n        _this.priority = 185;\r\n        _this.identifier = 'ReactPlugin';\r\n        var _analyticsPlugin;\r\n        var _extensionConfig;\r\n        var _unlisten;\r\n        var _pageViewTimer;\r\n        var _pageViewTracked;\r\n        dynamicProto(ReactPlugin, _this, function (_self, _base) {\r\n            _initDefaults();\r\n            _self.initialize = function (config, core, extensions, pluginChain) {\r\n                _super.prototype.initialize.call(_this, config, core, extensions, pluginChain);\r\n                _self._addHook(onConfigChange(config, function (details) {\r\n                    var _a;\r\n                    var ctx = _self._getTelCtx();\r\n                    _extensionConfig = ctx.getExtCfg(_this.identifier, defaultReactExtensionConfig);\r\n                    _analyticsPlugin = (_a = core.getPlugin(AnalyticsPluginIdentifier)) === null || _a === void 0 ? void 0 : _a.plugin;\r\n                    if (isFunction(_unlisten)) {\r\n                        _unlisten();\r\n                        _unlisten = null;\r\n                    }\r\n                    if (_extensionConfig.history) {\r\n                        _addHistoryListener(_extensionConfig.history);\r\n                        if (!_pageViewTracked) {\r\n                            var pageViewTelemetry = {\r\n                                uri: _extensionConfig.history.location.pathname\r\n                            };\r\n                            _self.trackPageView(pageViewTelemetry);\r\n                            _pageViewTracked = true;\r\n                        }\r\n                    }\r\n                }));\r\n            };\r\n            _self.getCookieMgr = function () {\r\n                return safeGetCookieMgr(_self.core);\r\n            };\r\n            _self.getAppInsights = _getAnalytics;\r\n            _self.processTelemetry = function (event, itemCtx) {\r\n                _self.processNext(event, itemCtx);\r\n            };\r\n            _self._doTeardown = function (unloadCtx, unloadState, asyncCallback) {\r\n                if (isFunction(_unlisten)) {\r\n                    _unlisten();\r\n                }\r\n                if (_pageViewTimer) {\r\n                    clearTimeout(_pageViewTimer);\r\n                }\r\n                _initDefaults();\r\n            };\r\n            // Proxy the analytics functions\r\n            proxyFunctions(_self, _getAnalytics, [\r\n                \"trackMetric\",\r\n                \"trackPageView\",\r\n                \"trackEvent\",\r\n                \"trackException\",\r\n                \"trackTrace\",\r\n            ]);\r\n            function _initDefaults() {\r\n                _analyticsPlugin = null;\r\n                _extensionConfig = null;\r\n                _unlisten = null;\r\n                _pageViewTimer = null;\r\n                _pageViewTracked = false;\r\n            }\r\n            function _getAnalytics() {\r\n                if (!_analyticsPlugin) {\r\n                    _throwInternal(_self.diagLog(), 1 /* eLoggingSeverity.CRITICAL */, 64 /* _eInternalMessageId.TelemetryInitializerFailed */, \"Analytics plugin is not available, React plugin telemetry will not be sent: \");\r\n                }\r\n                return _analyticsPlugin;\r\n            }\r\n            function _addHistoryListener(history) {\r\n                var locationListener = function (arg) {\r\n                    // v4 of the history API passes \"location\" as the first argument, while v5 passes an object that contains location and action \r\n                    var locn = null;\r\n                    if (\"location\" in arg) {\r\n                        // Looks like v5\r\n                        locn = arg[\"location\"];\r\n                    }\r\n                    else {\r\n                        locn = arg;\r\n                    }\r\n                    // Timeout to ensure any changes to the DOM made by route changes get included in pageView telemetry\r\n                    _pageViewTimer = setTimeout(function () {\r\n                        _pageViewTimer = null;\r\n                        var pageViewTelemetry = { uri: locn.pathname };\r\n                        _self.trackPageView(pageViewTelemetry);\r\n                    }, 500);\r\n                };\r\n                _unlisten = history.listen(locationListener);\r\n            }\r\n            objDefineAccessors(_self, \"_extensionConfig\", function () { return _extensionConfig; });\r\n        });\r\n        return _this;\r\n    }\r\n    ReactPlugin.prototype.initialize = function (config, core, extensions, pluginChain) {\r\n        // @DynamicProtoStub -- DO NOT add any code as this will be removed during packaging\r\n    };\r\n    /**\r\n     * Get the current cookie manager for this instance\r\n     */\r\n    ReactPlugin.prototype.getCookieMgr = function () {\r\n        // @DynamicProtoStub -- DO NOT add any code as this will be removed during packaging\r\n        return null;\r\n    };\r\n    /**\r\n     * Get application insights instance.\r\n     */\r\n    ReactPlugin.prototype.getAppInsights = function () {\r\n        // @DynamicProtoStub -- DO NOT add any code as this will be removed during packaging\r\n        return null;\r\n    };\r\n    /**\r\n     * Add Part A fields to the event\r\n     * @param event The event that needs to be processed\r\n     */\r\n    ReactPlugin.prototype.processTelemetry = function (event, itemCtx) {\r\n        // @DynamicProtoStub -- DO NOT add any code as this will be removed during packaging\r\n    };\r\n    ReactPlugin.prototype.trackMetric = function (metric, customProperties) {\r\n        // @DynamicProtoStub -- DO NOT add any code as this will be removed during packaging\r\n    };\r\n    ReactPlugin.prototype.trackPageView = function (pageView) {\r\n        // @DynamicProtoStub -- DO NOT add any code as this will be removed during packaging\r\n    };\r\n    ReactPlugin.prototype.trackEvent = function (event, customProperties) {\r\n        // @DynamicProtoStub -- DO NOT add any code as this will be removed during packaging\r\n    };\r\n    ReactPlugin.prototype.trackException = function (exception, customProperties) {\r\n        // @DynamicProtoStub -- DO NOT add any code as this will be removed during packaging\r\n    };\r\n    ReactPlugin.prototype.trackTrace = function (trace, customProperties) {\r\n        // @DynamicProtoStub -- DO NOT add any code as this will be removed during packaging\r\n    };\r\n    return ReactPlugin;\r\n}(BaseTelemetryPlugin));\r\nexport default ReactPlugin;\r\n//# sourceMappingURL=ReactPlugin.js.map"],"names":[],"mappings":";;;;AAAA;AACA;AACA;AACA;AACA,gFAAkC;AAClC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;qDAsCM,CAAC;;;;;;uBACgB;AACvB;AACA;AACA"}